---
import { getCollection } from 'astro:content';
import FullWidthLayout from '../layouts/FullWidthLayout.astro';
import ArashiRankCard from '../components/cards/ArashiRankCard.astro';

const arashi = await getCollection('arashi');
const characters = await getCollection('characters');

const ranked = arashi.sort((a, b) => {
  const ra = a.data.rank ?? a.data.arashiRank ?? 99;
  const rb = b.data.rank ?? b.data.arashiRank ?? 99;
  return ra - rb;
});
const topChars = characters
  .filter((c) => (c.data.power_rank ?? c.data.powerRank) !== undefined)
  .sort((a, b) => ((a.data.power_rank ?? a.data.powerRank) ?? 999) - ((b.data.power_rank ?? b.data.powerRank) ?? 999));
---
<FullWidthLayout title="Power Rankings — Eldunary" description="Official Arashi power ranking list">
  <div class="rank-page">
    <header class="rank-header">
      <span class="rank-type">Official Listing</span>
      <h1 class="rank-title">Power Rankings</h1>
      <p class="rank-desc">
        The Arashi are the officially ranked beings whose power transcends all conventional limits.
        Below them, notable characters are ranked by relative combat and magical potency.
      </p>
    </header>

    <section class="rank-section">
      <h2 class="rank-section-title">The Arashi — Ranked</h2>
      <div class="rank-list">
        {ranked.map((a) => (
          <ArashiRankCard
            name={a.data.name}
            slug={a.slug}
            rank={a.data.rank ?? a.data.arashiRank ?? 99}
            powerClass={a.data.power_class ?? a.data.powerClass ?? 'Unknown'}
            race={a.data.race}
            location={a.data.current_location ?? a.data.location}
            summary={a.data.summary}
          />
        ))}
      </div>
    </section>

    {topChars.length > 0 && (
      <section class="rank-section">
        <h2 class="rank-section-title">Notable Characters by Power</h2>
        <div class="char-table">
          <div class="char-table-header">
            <span>#</span><span>Name</span><span>Race</span><span>Class</span><span>Affiliation</span>
          </div>
          {topChars.map((c) => (
            <a href={`/characters/${c.slug}`} class="char-row">
              <span class="char-rank">#{c.data.power_rank ?? c.data.powerRank}</span>
              <span class="char-name">{c.data.name}</span>
              <span class="char-race">{c.data.race ?? '—'}</span>
              <span class="char-class">{c.data.power_class ?? c.data.powerClass ?? '—'}</span>
              <span class="char-aff">
                {Array.isArray(c.data.affiliation) ? c.data.affiliation[0] : (c.data.affiliation ?? c.data.organization ?? '—')}
              </span>
            </a>
          ))}
        </div>
      </section>
    )}
  </div>
</FullWidthLayout>

<style>
  .rank-page { max-width: 900px; margin: 0 auto; padding: 2rem 1.5rem; }
  .rank-header { margin-bottom: 2.5rem; }
  .rank-type { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.15em; color: var(--accent); }
  .rank-title { font-family: var(--font-cinzel), serif; font-size: clamp(1.8rem, 4vw, 2.5rem); color: var(--text-primary); margin: 0.5rem 0; }
  .rank-desc { color: var(--text-muted); max-width: 600px; }
  .rank-section { margin-bottom: 3rem; }
  .rank-section-title { font-family: var(--font-cinzel), serif; font-size: 1.1rem; color: var(--accent); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem; border-bottom: 1px solid rgba(196,155,92,0.2); padding-bottom: 0.5rem; }
  .rank-list { display: flex; flex-direction: column; gap: 0.75rem; }
  .char-table { border: 1px solid rgba(255,255,255,0.08); border-radius: 8px; overflow: hidden; font-size: 0.85rem; }
  .char-table-header { display: grid; grid-template-columns: 50px 1fr 1fr 1fr 1fr; gap: 1rem; padding: 0.6rem 1rem; background: rgba(255,255,255,0.04); color: var(--text-muted); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.08em; }
  .char-row { display: grid; grid-template-columns: 50px 1fr 1fr 1fr 1fr; gap: 1rem; padding: 0.65rem 1rem; border-top: 1px solid rgba(255,255,255,0.05); text-decoration: none; transition: background 0.15s; align-items: center; }
  .char-row:hover { background: rgba(255,255,255,0.03); }
  .char-rank { color: var(--accent); font-family: var(--font-cinzel), serif; font-weight: 700; }
  .char-name { color: var(--text-primary); font-weight: 500; }
  .char-race, .char-class, .char-aff { color: var(--text-muted); }
  @media (max-width: 600px) {
    .char-table-header, .char-row { grid-template-columns: 40px 1fr 1fr; }
    .char-class, .char-aff, .char-table-header span:nth-child(4), .char-table-header span:nth-child(5) { display: none; }
  }
</style>
